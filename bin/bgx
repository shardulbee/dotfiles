#!/usr/bin/env bash
set -e

session=""
if [[ "$1" == "-t" ]]; then
    session=$(tmux list-sessions -F '#{session_name}' 2>/dev/null | fzf)
    [[ -z "$session" ]] && exit 0
    shift
fi

if [[ -z "$session" ]]; then
    read -p "Enter session name: " session
    [[ -z "$session" ]] && session="bg-$$"
fi

tmux has-session -t "$session" 2>/dev/null && tmux new-window -t "$session" bash -c "$*; read -p $'\n[Press Enter to close] '" || tmux new-session -d -s "$session" bash -c "$*; read -p $'\n[Press Enter to close] '"
